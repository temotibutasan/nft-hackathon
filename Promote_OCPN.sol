// SPDX-License-Identifier: MIT

pragma solidity >=0.7.0 <0.9.0;

import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "./Base64.sol";

contract NFT is ERC721Enumerable, Ownable {
  address[] private userIndex;
  address[] private luckyAddress;
  using Strings for uint256;
  string public luckyUri;
  string public unLuckyUri;
  uint256 public maxSupply = 1;
  uint256 public maxLucky = 10;
  uint256 public probability = 3000;
  bool public drawingResult = false;

  constructor(
    string memory _initLuckyURI,
    string memory _initUnLuckyUri
  ) ERC721("OnChainPromoteNft", "OCPN") {
    setLuckyURI(_initLuckyURI);
    setUnUnLuckyURI(_initUnLuckyUri);
    mint(1);
  }

  // public
  function mint(uint256 _mintAmount) public payable {
    uint256 supply = totalSupply();
    require(_mintAmount > 0);
    require(supply + _mintAmount <= maxSupply);

    for (uint256 i = 1; i <= _mintAmount; i++) {
      _safeMint(msg.sender, supply + i);
    }
  }

  function tokenURI(uint256 tokenId)
    public
    view
    virtual
    override
    returns (string memory)
  {
    require(
      _exists(tokenId),
      "ERC721Metadata: URI query for nonexistent token"
    );
    
    if(drawingResult){
        return luckyUri;
    } else{
        return unLuckyUri;
    }
  }
  
  function setLuckyURI(string memory _newURI) public onlyOwner {
    luckyUri = _newURI;
  }

  function setUnUnLuckyURI(string memory _newURI) public onlyOwner {
    unLuckyUri = _newURI;
  }


  function transferFrom(
    address from,
    address to,
    uint256 tokenId
  ) public virtual override {
    //solhint-disable-next-line max-line-length
    require(_isApprovedOrOwner(_msgSender(), tokenId), "ERC721: transfer caller is not owner nor approved");

    if(isUser(to)) {
        drawingResult = false;
    } else {
        drawingResult = drawing(tokenId);
        if(drawingResult == true){
            luckyAddress.push(to);
        }
        userIndex.push(to);
    }
    _transfer(from, to, tokenId);
  }

  function safeTransferFrom(
        address from,
        address to,
        uint256 tokenId
  ) public virtual override {
    safeTransferFrom(from, to, tokenId, "");
  }

  function luckyImage() public pure returns(string memory) {
   return Base64.encode(bytes(abi.encodePacked(
    '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">',
    '<rect stroke="#000" id="svg_4" height="600" width="800" y="0" x="0" opacity="NaN" stroke-width="0" fill="#FFB27C"/>',
    '<text font-style="italic" font-weight="bold" fill="#000000" x="112.32814" y="359.14696" id="svg_6" stroke-width="0" font-size="24" font-family="Noto Sans JP" text-anchor="start" xml:space="preserve" stroke="#000" transform="matrix(2.60693 0 0 2.49236 -238.02 -397.61)">Congratulations!</text>',
    '<ellipse fill="#FFF093" cx="384.1" cy="252.4" id="svg_14" rx="146.5" ry="142" stroke="#000"/>',
    '<ellipse fill="#ffffff" cx="384.1" cy="252.40002" id="svg_15" rx="133.49999" ry="129.99998" stroke="#000"/>',
    '<path fill="#ffffff" d="m439.71707,414.17729l-10.81719,7.55683l4.13498,-12.22394l-10.81475,-7.55683l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70714l4.12767,12.21574l13.37172,0l-10.81962,7.55683l4.1362,12.22745l-10.81962,-7.56034l0,0l0,0.00001z" id="svg_20" stroke="#000"/>',
    '<path fill="#ffffff" d="m221.71707,325.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_21" stroke="#000"/>',
    '<path fill="#ffffff" d="m246.71707,149.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_22" stroke="#000"/>',
    '<path fill="#ffffff" d="m210.71707,281.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_23" stroke="#000"/>',
    '<path fill="#ffffff" d="m276.71707,391.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_24" stroke="#000"/>',
    '<path fill="#ffffff" d="m486.71707,390.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_25" stroke="#000"/>',
    '<path fill="#ffffff" d="m479.71707,121.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_26" stroke="#000"/>',
    '<path fill="#ffffff" d="m544.71707,196.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_27" stroke="#000"/>',
    '<path fill="#ffffff" d="m325.71707,101.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_28" stroke="#000"/>',
    '<path fill="#ffffff" d="m326.71707,409.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_29" stroke="#000"/>',
    '<path fill="#ffffff" d="m556.71707,287.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_30" stroke="#000"/>',
    '<path fill="#ffffff" d="m282.71707,118.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_32" stroke="#000"/>',
    '<path fill="#ffffff" d="m381.71707,423.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_33" stroke="#000"/>',
    '<path fill="#ffffff" d="m219.71707,190.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_34" stroke="#000"/>',
    '<path fill="#ffffff" d="m241.71707,360.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_35" stroke="#000"/>',
    '<path fill="#ffffff" d="m520.71707,152.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_36" stroke="#000"/>',
    '<path fill="#ffffff" d="m542.71707,326.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_37" stroke="#000"/>',
    '<path fill="#ffffff" d="m519.71707,363.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_38" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="720.1" cy="333.4" id="svg_46" rx="42" ry="42" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="623.09999" cy="244.4" id="svg_48" rx="10" ry="10" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="644.1" cy="155.4" id="svg_49" rx="30" ry="30" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="33.1" cy="92.4" id="svg_50" rx="18" ry="17" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="66.1" cy="328.4" id="svg_51" rx="10" ry="10" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="69.1" cy="221.4" id="svg_52" rx="42" ry="42" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="209.1" cy="69.4" id="svg_53" rx="42" ry="42" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="160.1" cy="209.4" id="svg_54" rx="20" ry="20" opacity="0.2" stroke="#000"/>',
    '<ellipse fill="#FFF5FF" cx="605.1" cy="385.4" id="svg_55" rx="18" ry="18" opacity="0.2" stroke="#000"/>',
    '<path fill="#ffffff" d="m557.71707,247.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_56" stroke="#000"/>',
    '<path fill="#ffffff" d="m209.71707,235.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_57" stroke="#000"/>',
    '<text fill="#A8FFE9" x="389.6" y="262.9289" id="svg_58" font-size="24" font-family="Noto Sans JP" text-anchor="start" xml:space="preserve" stroke="#000" transform="matrix(2.59226 0 0 2.81396 -686.558 -457.427)">',unicode"景品",'</text>',
    '<path fill="#ffffff" d="m433.71707,98.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_59" stroke="#000"/>',
    '<path fill="#ffffff" d="m381.71707,94.17729l-10.81718,7.55683l4.13498,-12.22394l-10.81475,-7.55682l13.36806,0.00234l3.55297,-10.51095l0.57958,-1.70713l4.12767,12.21574l13.37172,0l-10.81962,7.55682l4.1362,12.22745l-10.81963,-7.56034l0,0z" id="svg_60" stroke="#000"/>',
    '</svg>'
    )));
  }

  function unLuckyImage() public pure returns(string memory) {
      return Base64.encode(bytes(abi.encodePacked(
'<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">',
'<rect stroke="#000" style="vector-effect: non-scaling-stroke;" id="svg_24" height="600" width="800" y="0" x="0" stroke-width="0" fill="#B6C7EA"/>',
'<text font-style="italic" font-weight="bold" transform="matrix(6.63244 0 0 6.0648 -661.965 -1786.14)" stroke="#000" xml:space="preserve" text-anchor="start" font-family="Alegreya" font-size="24" id="svg_23" y="350.44481" x="130.48488" stroke-width="0" fill="#A8FFE9">',unicode"残念！",'</text>',
'<path id="svg_22" d="m125.15068,324.64536c-0.83112,-0.05284 -1.42684,-0.22076 -1.29146,-0.36402c0.08537,-0.09034 1.88644,-0.63874 2.04373,-0.62229c0.05134,0.00537 0.50818,0.13322 1.0152,0.28412c0.81219,0.24172 0.92186,0.2868 0.92186,0.37891c0,0.18671 -0.88307,0.33964 -1.94338,0.33656c-0.30941,-0.0009 -0.64508,-0.00688 -0.74593,-0.01329l0,0l-0.00002,0.00001zm0.83269,-0.09391c0.02751,-0.02417 -0.03675,-0.03596 -0.19603,-0.03596c-0.36302,0 -0.86659,-0.0778 -0.97909,-0.15126c-0.12001,-0.07837 -0.43822,-0.08769 -0.48522,-0.01421c-0.09055,0.14156 1.50779,0.33548 1.66034,0.20144l0,0l0,-0.00001z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_21" d="m560.98785,476.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_20" d="m238.98785,489.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_19" d="m706.98785,176.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_18" d="m95.98785,206.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_17" d="m144.98785,387.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_16" d="m755.98785,381.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_15" d="m738.98785,552.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_14" d="m391.98785,523.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_13" d="m62.98785,533.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_12" d="m238.98785,137.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_11" d="m538.98785,224.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_10" d="m22.98785,337.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_9" d="m653.98785,344.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_8" d="m339.98785,242.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_7" d="m426.98785,398.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_6" d="m28.98785,123.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_5" d="m430.98785,163.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_4" d="m591.98785,587.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<path opacity="0.4" filter="url(#svg_1)" id="svg_3" d="m606.98785,105.23297c-12.67464,-5.0202 -21.75941,-20.97177 -19.69481,-34.58135c1.30188,-8.58188 28.76818,-60.67983 31.16686,-59.11718c0.7829,0.51002 7.7497,12.65624 15.48178,26.9916c12.38598,22.96373 14.05832,27.24576 14.05832,35.99632c0,17.73704 -13.46688,32.26568 -29.63665,31.9733c-4.71857,-0.08533 -9.83755,-0.65354 -11.3755,-1.26269l0,0zm12.69856,-8.92108c0.41953,-2.29632 -0.56048,-3.41622 -2.98953,-3.41622c-5.53605,0 -13.21545,-7.39079 -14.93114,-14.36998c-1.83018,-7.44491 -6.68281,-8.33033 -7.39956,-1.35014c-1.38094,13.44833 22.99376,31.87005 25.32023,19.13634l0,0z" stroke-width="0" stroke="#000" fill="#A8FFE9"/>',
'<defs transform="translate(14.5435 0) translate(0 -15.936)">',
'<filter id="svg_1">',
'<feGaussianBlur stdDeviation="2.9" in="SourceGraphic"/>',
'</filter>',
'</defs>',
'</svg>' 
      )));
  }

  function random(string memory input) internal pure returns (uint256) {
    return uint256(keccak256(abi.encodePacked(input)));
  }

  function drawing(uint256 tokenId) public
    view
    returns (bool) 
  {

    if(luckyAddress.length >= maxLucky){
        return false;
    }

    uint256 rand = random(string(abi.encodePacked(toString(tokenId))));
    if(rand % probability == 0){
        return true;
    } else {
        return true;
    }
  }

  function isUser(address userAddress)  public
    view
    returns (bool) {
    if(userIndex.length == 0) return false;
    return (userIndex[userStructs[userAddress].index] == userAddress);
  }

    function insertUser(address userAddress) 
    public
    returns(bool)
    {
        if(isUser(userAddress)) return false;
        userIndex.push(userAddress);
        userStructs[userAddress].index = userIndex.length-1;
        LogNewUser(
            userAddress, 
            userStructs[userAddress].index);
        return true;
    }

     function toString(uint256 value) internal pure returns (string memory) {
    // Inspired by OraclizeAPI's implementation - MIT license
    // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol

        if (value == 0) {
            return "0";
        }
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }
}